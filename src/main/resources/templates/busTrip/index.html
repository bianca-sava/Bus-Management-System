<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Bus Trip Management</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">

    <script>
        function goToNewTripPage() {
            window.location.href = '/bus-trip/new';
        }
    </script>
</head>
<body>

<div class="back-button-container">
    <a th:href="@{/home}" class="btn btn-primary">
        üè† Go to Home Page
    </a>
</div>

<h1>Bus Trip List</h1>

<div class="main-container">

    <aside class="sidebar">
        <form th:action="@{/bus-trip}" method="get">
            <h3>FiltreazƒÉ Curse</h3>

            <div class="filter-group">
                <label class="group-title">Identificare</label>
                <input type="text" name="id" th:value="${filterId}" placeholder="Trip ID..." style="margin-bottom: 10px;">
                <input type="text" name="routeId" th:value="${filterRouteId}" placeholder="Route ID..." style="margin-bottom: 10px;">
                <input type="text" name="busId" th:value="${filterBusId}" placeholder="Bus ID...">
            </div>

            <div class="filter-group">
                <label class="group-title">Status</label>
                <select name="status" class="form-control" style="width: 100%;">
                    <option value="">-- Toate --</option>
                    <option th:each="opt : ${statusOptions}"
                            th:value="${opt}"
                            th:text="${opt}"
                            th:selected="${filterStatus == opt}">
                    </option>
                </select>
            </div>

            <div class="filter-group">
                <label class="group-title">Start Time Range</label>
                <div style="display: flex; flex-direction: column; gap: 5px;">
                    <label style="font-size: 12px; color: #666;">De la:</label>
                    <input type="datetime-local" name="minTime" th:value="${filterMinTime}" class="form-control">

                    <label style="font-size: 12px; color: #666; margin-top: 5px;">P√¢nƒÉ la:</label>
                    <input type="datetime-local" name="maxTime" th:value="${filterMaxTime}" class="form-control">
                </div>
            </div>

            <button type="submit" class="btn-apply">AplicƒÉ Filtrele</button>
            <a th:href="@{/bus-trip}" class="btn-reset">ReseteazƒÉ filtre</a>
        </form>
    </aside>

    <main class="content-area">

        <div style="text-align: right; margin-bottom: 15px;">
            <button type="button" class="btn btn-success" onclick="goToNewTripPage()">Add New Trip</button>
        </div>

        <table>
            <thead>
            <tr>
                <th>
                    <th:block th:with="sortField='id',
                               currentSort=${pageable.getSort().getOrderFor(sortField)},
                               currentDirection=${currentSort != null ? currentSort.direction.name() : 'ASC'},
                               newDirection=${currentDirection == 'ASC' ? 'DESC' : 'ASC'}">

                        <a th:href="@{/bus-trip(
                            page=${busTripPage.number},
                            size=${busTripPage.size},
                            sort=__${sortField}__ + ',' + __${newDirection}__,
                            id=${filterId}, routeId=${filterRouteId}, busId=${filterBusId},
                            status=${filterStatus}, minTime=${filterMinTime}, maxTime=${filterMaxTime}
                          )}">
                            ID
                        </a>
                        <span th:if="${currentSort != null}" th:text="${currentDirection == 'ASC' ? ' ‚ñ≤' : ' ‚ñº'}"></span>
                    </th:block>
                </th>

                <th>Route ID</th>
                <th>Bus ID</th>

                <th>
                    <th:block th:with="sortField='startTime',
                               currentSort=${pageable.getSort().getOrderFor(sortField)},
                               currentDirection=${currentSort != null ? currentSort.direction.name() : 'ASC'},
                               newDirection=${currentDirection == 'ASC' ? 'DESC' : 'ASC'}">

                        <a th:href="@{/bus-trip(
                            page=${busTripPage.number},
                            size=${busTripPage.size},
                            sort=__${sortField}__ + ',' + __${newDirection}__,
                            id=${filterId}, routeId=${filterRouteId}, busId=${filterBusId},
                            status=${filterStatus}, minTime=${filterMinTime}, maxTime=${filterMaxTime}
                          )}">
                            Start Time
                        </a>
                        <span th:if="${currentSort != null}" th:text="${currentDirection == 'ASC' ? ' ‚ñ≤' : ' ‚ñº'}"></span>
                    </th:block>
                </th>

                <th>
                    <th:block th:with="sortField='status',
                               currentSort=${pageable.getSort().getOrderFor(sortField)},
                               currentDirection=${currentSort != null ? currentSort.direction.name() : 'ASC'},
                               newDirection=${currentDirection == 'ASC' ? 'DESC' : 'ASC'}">

                        <a th:href="@{/bus-trip(
                            page=${busTripPage.number},
                            size=${busTripPage.size},
                            sort=__${sortField}__ + ',' + __${newDirection}__,
                            id=${filterId}, routeId=${filterRouteId}, busId=${filterBusId},
                            status=${filterStatus}, minTime=${filterMinTime}, maxTime=${filterMaxTime}
                          )}">
                            Status
                        </a>
                        <span th:if="${currentSort != null}" th:text="${currentDirection == 'ASC' ? ' ‚ñ≤' : ' ‚ñº'}"></span>
                    </th:block>
                </th>

                <th>
                    <th:block th:with="sortField='nrOfTickets',
                               currentSort=${pageable.getSort().getOrderFor(sortField)},
                               currentDirection=${currentSort != null ? currentSort.direction.name() : 'ASC'},
                               newDirection=${currentDirection == 'ASC' ? 'DESC' : 'ASC'}">

                        <a th:href="@{/bus-trip(
                            page=${busTripPage.number},
                            size=${busTripPage.size},
                            sort=__${sortField}__ + ',' + __${newDirection}__,
                            id=${filterId}, routeId=${filterRouteId}, busId=${filterBusId},
                            status=${filterStatus}, minTime=${filterMinTime}, maxTime=${filterMaxTime}
                          )}">
                            Tickets
                        </a>
                        <span th:if="${currentSort != null}" th:text="${currentDirection == 'ASC' ? ' ‚ñ≤' : ' ‚ñº'}"></span>
                    </th:block>
                </th>

                <th>
                    <th:block th:with="sortField='nrOfAssignments',
                               currentSort=${pageable.getSort().getOrderFor(sortField)},
                               currentDirection=${currentSort != null ? currentSort.direction.name() : 'ASC'},
                               newDirection=${currentDirection == 'ASC' ? 'DESC' : 'ASC'}">

                        <a th:href="@{/bus-trip(
                            page=${busTripPage.number},
                            size=${busTripPage.size},
                            sort=__${sortField}__ + ',' + __${newDirection}__,
                            id=${filterId}, routeId=${filterRouteId}, busId=${filterBusId},
                            status=${filterStatus}, minTime=${filterMinTime}, maxTime=${filterMaxTime}
                          )}">
                            Assignments
                        </a>
                        <span th:if="${currentSort != null}" th:text="${currentDirection == 'ASC' ? ' ‚ñ≤' : ' ‚ñº'}"></span>
                    </th:block>
                </th>

                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="item : ${busTrips}">
                <td th:text="${item.id}">TRIP1</td>
                <td th:text="${item.routeId}">ROUTE1</td>
                <td th:text="${item.busId}">BUS1</td>
                <td th:text="${item.startTime.replace('T', ' ')}">10:00</td>
                <td th:text="${item.status}">PLANNED</td>
                <td th:text="${item.tickets.size}">0</td>
                <td th:text="${item.assignments.size}">0</td>

                <td class="action-cell">
                    <a th:href="@{'/bus-trip/' + ${item.id} + '/tickets'}" class="btn-warning">View Tickets</a>
                    <a th:href="@{'/bus-trip/' + ${item.id} + '/assignments'}" class="btn-warning">View Assignments</a>
                    <a th:href="@{'/bus-trip/' + ${item.id} + '/edit'}" class="btn-warning">Edit</a>
                    <form th:action="@{'/bus-trip/' + ${item.id} + '/delete'}" method="post" style="display: inline;">
                        <button type="submit" class="btn-danger">Delete</button>
                    </form>
                </td>
            </tr>
            <tr th:if="${#lists.isEmpty(busTrips)}">
                <td colspan="8" style="text-align:center; padding: 20px;">No trips found matching your criteria.</td>
            </tr>
            </tbody>
        </table>

        <div th:if="${busTripPage.totalPages > 1}" class="pagination-container">
            <a th:if="${busTripPage.hasPrevious()}"
               th:href="@{/bus-trip(
                   page=${busTripPage.number - 1},
                   size=${busTripPage.size},
                   sort=${busTripPage.sort.toString().replace(': ', ',')},
                   id=${filterId}, routeId=${filterRouteId}, busId=${filterBusId},
                   status=${filterStatus}, minTime=${filterMinTime}, maxTime=${filterMaxTime}
               )}"
               class="btn btn-primary">‚¨Ö Previous</a>

            <span th:text="'Page ' + ${busTripPage.number + 1} + ' of ' + ${busTripPage.totalPages}" style="font-weight: bold;"></span>

            <a th:if="${busTripPage.hasNext()}"
               th:href="@{/bus-trip(
                   page=${busTripPage.number + 1},
                   size=${busTripPage.size},
                   sort=${busTripPage.sort.toString().replace(': ', ',')},
                   id=${filterId}, routeId=${filterRouteId}, busId=${filterBusId},
                   status=${filterStatus}, minTime=${filterMinTime}, maxTime=${filterMaxTime}
               )}"
               class="btn btn-primary">Next ‚û°</a>
        </div>

    </main>
</div>

</body>
</html>